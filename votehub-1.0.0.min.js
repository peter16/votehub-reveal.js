var api_key="";var votehub_user_username="";var votehub_user_password="";var votehub_user_id="";function SetVotehubUser(b,c,a){votehub_user_username=b;votehub_user_password=c;votehub_user_id=a;votehub(api_key)}function votehub(a){api_key=a;sections=document.getElementsByTagName("section");for(var c=0;c<sections.length;c++){if(sections[c].id.match(/^questions-.*$/)){var b=sections[c].id.split("-");questions(b[1])}if(sections[c].id.match(/^answers-.*$/)){var b=sections[c].id.split("-");answers(b[1])}if(sections[c].id.match(/^stats-.*$/)){var b=sections[c].id.split("-");stats(b[1])}}}$(function stats_check(){var a=false;sections=document.getElementsByTagName("section");window.setInterval(function(){for(var c=0;c<sections.length;c++){if(sections[c].className==="present"){a=sections[c].id.match(/^stats-.*$/);split=sections[c].id.split("-")}}},2000);var b=setInterval(function(){if(a){if(votehub_user_id){stats(split[1])}else{$.ajax({type:"GET",url:"http://www.votehub.net/api/v1/surveys/segment/"+split[1]+"/?api_key="+api_key,dataType:"json",async:false,success:function(c){if(c.statistics_policy=="PUBLIC"&&c.is_active==true){stats(split[1])}},error:function(c){}})}}},5000)});$(function(){$("body").on("submit","form",function(){var i=false;$('input[type="hidden"]',this).each(function(){if($(this).data("voter")=="login"){i=true}});if(i==true){var g="";var j="";$('input[type="text"]',this).each(function(){if($(this).data("login")=="username"){g=this.value}});$('input[type="password"]',this).each(function(){if($(this).data("login")=="password"){j=this.value}});votehub_login(g,j);return false}else{var k={};var c=[];var e=[];var b=0;var l="";var h=false;var f=new Array();var a=0;$('input[type="hidden"]',this).each(function(){if($(this).data("required")==true){f[a]=this.value;a++}});for(a=0;a<f.length;a++){if($("input[name="+f[a]+"]").is(":text")){if($("input[name="+f[a]+"]").val()===""){h=true}}else{if($("input[name="+f[a]+"]:checked").length==0){h=true}}}$('input[type="radio"]:checked',this).each(function(){e.push({question_id:$(this).data("questionid"),option_id:this.value})});$('input[type="checkbox"]:checked',this).each(function(){e.push({question_id:$(this).data("questionid"),option_id:this.value})});$('input[type="text"]',this).each(function(){e.push({question_id:$(this).data("questionid"),custom:this.value})});$('input[type="hidden"]',this).each(function(){if($(this).data("voter")=="voted_questions"){c.push($(this).data("questionid"))}if($(this).data("voter")=="voting_started"){k.voting_started=this.value}if($(this).data("voter")=="id_segment"){b=this.value}if($(this).data("voter")=="postface"){l=this.value}});var d={voter:k,voted_questions:c,answers:e};if(h==true){alert("Fill in all required fields.");return false}send_questions(d,b,l);return false}})});function votehub_login(a,b){$.ajax({type:"POST",url:"http://www.votehub.net/api/v1/accounts/login/?api_key="+api_key,dataType:"json",headers:{Authorization:"Basic "+btoa(a+":"+b)},success:function(c){alert("Login successful.");SetVotehubUser(a,b,c.user.id)},error:function(c){alert("Your email or password was incorrect.")}})}function send_questions(c,a,b){$.ajax({type:"POST",url:"http://www.votehub.net/api/v1/voting/"+a+"/vote/?api_key="+api_key,format:"jsonp",dataType:"json",data:JSON.stringify(c),success:function(d){$("#questions-"+a).html(b)},error:function(d){$("#questions-"+a).html(d.responseJSON.message)}})}function activate_segment(a){$.ajax({type:"POST",url:"http://www.votehub.net/api/v1/surveys/segment/"+a+"/update/?api_key="+api_key,dataType:"json",headers:{Authorization:"Basic "+btoa(votehub_user_username+":"+votehub_user_password)},data:'{"is_active": true}',success:function(b){alert("Segment is active.");votehub(api_key)},error:function(b){alert("Segment is inactive. An error has occurred or you are not a creator segment.")}})}function questions(a){var b="http://www.votehub.net/api/v1/surveys/segment/"+a+"/?api_key="+api_key;$.ajax({type:"GET",url:b,dataType:"json",async:false,success:function(d,f,i){var c="";var g=new Date(i.getResponseHeader("Date"));var h=g.toISOString();if(!d.date_to){d.date_to=h}if(!d.date_from){d.date_from=h}if(d.date_from<=h&&h<=d.date_to){if(d.is_active==true){var e="http://www.votehub.net/api/v1/surveys/"+d.survey_id+"/?api_key="+api_key;$.ajax({type:"GET",url:e,dataType:"json",async:false,success:function(o){$("#questions-"+a).empty();c+="<form name='survey' id='"+o.id+"' action='' method='post'>";for(var m=0;m<o.questions.length;m++){c+="<br> <p> <b>"+(m+1)+". "+o.questions[m].title+"</b>";if(o.questions[m].is_required==true){c+=" *</p>"}else{c+="</p>"}if(o.questions[m].kind=="TEXTFIELD"||o.questions[m].kind=="TEXTAREA"||o.questions[m].kind=="EMAIL"||o.questions[m].kind=="PHONE"||o.questions[m].kind=="DATE"||o.questions[m].kind=="TIME"){c+="<input type='text' name='"+o.questions[m].id+"' data-questionid='"+o.questions[m].id+"' size='50'>"}if(o.questions[m].kind=="STARS"){c+="<span class='star-rating star-"+o.questions[m].options.length+"'>"}for(var k=0;k<o.questions[m].options.length;k++){if(o.questions[m].kind=="RADIO"||o.questions[m].kind=="GENDER"||o.questions[m].kind=="THUMBS"||o.questions[m].kind=="SELECT_SINGLE"){c+="<input type='radio' name='"+o.questions[m].id+"' data-questionid='"+o.questions[m].id+"' data-required='"+o.questions[m].is_required+"' value='"+o.questions[m].options[k].id+"'>"+o.questions[m].options[k].title+"<br>"}else{if(o.questions[m].kind=="CHECKBOX"||o.questions[m].kind=="SELECT_MULTIPLE"){c+="<input type='checkbox' name='"+o.questions[m].id+"' data-questionid='"+o.questions[m].id+"' value='"+o.questions[m].options[k].id+"'>"+o.questions[m].options[k].title+"<br>"}else{if(o.questions[m].kind=="STARS"){c+="<input type='radio' name='"+o.questions[m].id+"' data-questionid='"+o.questions[m].id+"' value='"+o.questions[m].options[k].id+"'><i></i>"}}}}if(o.questions[m].kind=="STARS"){c+="</span><br>"}c+="<input type='hidden' name='voter' data-voter='voted_questions' data-questionid='"+o.questions[m].id+"' data-required='"+o.questions[m].is_required+"' value='"+o.questions[m].id+"'>"}c+="<input type='hidden' name='voter' data-voter='id_segment' value='"+a+"'>";c+="<input type='hidden' name='voter' data-voter='postface' value='"+o.postface+"'>";c+="<input type='hidden' name='voter' data-voter='voting_started' value='"+h+"'>";c+="<br><input type='submit' value='Send'><br>";c+="</form>";var n="http://www.votehub.net/"+a;var l="www.votehub.net/"+a;c+="<br> <a href='"+n+"' target='_blank'>"+l+"</a>";$("#questions-"+a).html(c)},error:function(j){$("#questions-"+a).html(j.responseJSON.message)}})}else{$("#questions-"+a).empty();c+="Segment is inactive. Only creator can activate segment.";if(votehub_user_id){c+="<br><br>You can activate segment by pressing button.";c+="<br><button onclick='activate_segment("+a+")'>Activate</button>"}else{c+="<br><br>Log in to activating segment.<br>";c+="<br><form name='login' id='login' action='' method='post'>";c+="E-mail <input type='text' name='username' data-login='username' size='50'>";c+="Password <input type='password' name='password' data-login='password' size='50'>";c+="<input type='hidden' name='login' data-voter='login' value='login'>";c+="<br><input type='submit' value='Login'><br>";c+="</form>";c+="<br>You can also activate segment in your profile at: <a href='http://www.votehub.net' target='_blank'>www.votehub.net</a>"}$("#questions-"+a).html(c)}}else{$("#questions-"+a).empty();c+="Segment is inactive. Time range is not valid.";c+="<br><br>You can change time range in your profile at: <a href='http://www.votehub.net' target='_blank'>www.votehub.net</a>";$("#questions-"+a).html(c)}},error:function(c){$("#questions-"+a).html(c.responseJSON.message)}})}function answers(b){var a="http://www.votehub.net/api/v1/surveys/segment/"+b+"/?api_key="+api_key;$.ajax({type:"GET",url:a,dataType:"json",async:false,success:function(c){var d="";if(c.is_active==true){if(votehub_user_id){var f="http://www.votehub.net/api/v1/surveys/"+c.survey_id+"/?api_key="+api_key;var e={};if(votehub_user_id){e.Authorization="Basic "+btoa(votehub_user_username+":"+votehub_user_password)}$.ajax({type:"GET",url:f,dataType:"json",async:false,headers:e,success:function(k){$("#answers-"+b).empty();d+="<br>Correct answers:<br>";for(var h=0;h<k.questions.length;h++){d+="<br> <p> <b>"+(h+1)+". "+k.questions[h].title+"</b>";if(k.questions[h].is_required==true){d+=" *</p>"}else{d+="</p>"}d+="<p>";for(var g=0;g<k.questions[h].options.length;g++){if(k.questions[h].options[g].is_correct==true){if(k.questions[h].kind=="RADIO"||k.questions[h].kind=="CHECKBOX"){d+="<li>"+k.questions[h].options[g].title+"</li>"}else{d+=k.questions[h].options[g].title+"<br>"}}}d+="</p>"}$("#answers-"+b).html(d)},error:function(g){$("#answers-"+b).html(g.responseJSON.message)}})}else{d+="Segment is not public. Only creator can show correct answers.";d+="<br><br>Log in to showing answers.<br>";d+="<br><form name='login' id='login' action='' method='post'>";d+="E-mail <input type='text' name='username' data-login='username' size='50'>";d+="Password <input type='password' name='password' data-login='password' size='50'>";d+="<input type='hidden' name='login' data-voter='login' value='login'>";d+="<br><input type='submit' value='Login'><br>";d+="</form>";d+="<br>You can also change the settings of segment in your profile at: <a href='http://www.votehub.net' target='_blank'>www.votehub.net</a>";$("#answers-"+b).html(d)}}else{$("#answers-"+b).empty();d+="Segment is inactive. Only creator can activate segment.";if(votehub_user_id){d+="<br><br>You can activate segment by pressing button.";d+="<br><button onclick='activate_segment("+b+")'>Activate</button>"}else{d+="<br><br>Log in to activating segment.<br>";d+="<br><form name='login' id='login' action='' method='post'>";d+="E-mail <input type='text' name='username' data-login='username' size='50'>";d+="Password <input type='password' name='password' data-login='password' size='50'>";d+="<input type='hidden' name='login' data-voter='login' value='login'>";d+="<br><input type='submit' value='Login'><br>";d+="</form>";d+="<br>You can also activate segment in your profile at: <a href='http://www.votehub.net' target='_blank'>www.votehub.net</a>"}$("#answers-"+b).html(d)}},error:function(c){$("#answers-"+b).html(c.responseJSON.message)}})}function stats(a){var c="http://www.votehub.net/api/v1/voters/"+a+"/?api_key="+api_key;var b="http://www.votehub.net/api/v1/surveys/segment/"+a+"/?api_key="+api_key;$.ajax({type:"GET",url:b,dataType:"json",async:false,success:function(f){var d="";if(f.is_active==true){if(votehub_user_id||f.statistics_policy=="PUBLIC"){var e={};if(votehub_user_id){e.Authorization="Basic "+btoa(votehub_user_username+":"+votehub_user_password)}$.ajax({type:"GET",url:c,dataType:"json",async:false,headers:e,success:function(l){var s=new Array();var g=0;for(var n=0;n<l.voters.length;n++){for(var m=0;m<l.voters[n].voted_questions.length;m++){for(var h=0;h<l.voters[n].voted_questions[m].answers.length;h++){if(l.voters[n].voted_questions[m].answers[h].option==null){s[g]=l.voters[n].voted_questions[m].answers[h].custom;g++}else{s[g]=l.voters[n].voted_questions[m].answers[h].option;g++}}}}var p={};for(var r=0;r<s.length;r++){p[s[r]]=1+(p[s[r]]||0)}var q="http://www.votehub.net/api/v1/surveys/"+f.survey_id+"/?api_key="+api_key;$.ajax({type:"GET",url:q,dataType:"json",async:false,success:function(v){var k=new Array();for(var w=0;w<v.questions.length;w++){var o=0;for(var t=0;t<v.questions[w].options.length;t++){if(p[v.questions[w].options[t].id]==null){o+=0}else{o+=p[v.questions[w].options[t].id]}}k[w]=o}$("#stats-"+a).empty();for(var w=0;w<v.questions.length;w++){d+="<br> <p> <b>"+(w+1)+". "+v.questions[w].title+"</b>";if(v.questions[w].is_required==true){d+=" *</p>"}else{d+="</p>"}var D=0;if(v.questions[w].kind=="TEXTFIELD"||v.questions[w].kind=="TEXTAREA"||v.questions[w].kind=="EMAIL"||v.questions[w].kind=="PHONE"||v.questions[w].kind=="DATE"||v.questions[w].kind=="TIME"){for(var E=0;E<l.voters.length;E++){for(var C=0;C<l.voters[E].voted_questions.length;C++){if(l.voters[E].voted_questions[C].question_id==v.questions[w].id){for(var B=0;B<l.voters[E].voted_questions[C].answers.length;B++){if(l.voters[E].voted_questions[C].answers[B].option==null){if(!l.voters[E].voted_questions[C].answers[B].custom==null||!l.voters[E].voted_questions[C].answers[B].custom==""){d+="<li>"+l.voters[E].voted_questions[C].answers[B].custom+"</li>";D++}}}}}}d+="Total answers: "+D+"<br>"}if(v.questions[w].kind=="STARS"){d+="<span class='star-rating star-"+v.questions[w].options.length+"'>";var A=0;var u=0}for(var t=0;t<v.questions[w].options.length;t++){var x=0;if(v.questions[w].kind=="RADIO"||v.questions[w].kind=="CHECKBOX"||v.questions[w].kind=="GENDER"||v.questions[w].kind=="THUMBS"||v.questions[w].kind=="SELECT_SINGLE"||v.questions[w].kind=="SELECT_MULTIPLE"){d+="<li>"+v.questions[w].options[t].title+"</li>";if(p[v.questions[w].options[t].id]==null){d+="<p> <progress value='0' max='100'></progress> <span style='font-size: 30px'>0%, votes: 0</span> </p>"}else{x=((p[v.questions[w].options[t].id]*100)/k[w]);d+="<p> <progress value='"+x+"' max='100'></progress> <span style='font-size: 30px'>"+Math.round(x)+"%, votes: "+p[v.questions[w].options[t].id]+"</span> </p>"}}if(v.questions[w].kind=="STARS"){if(p[v.questions[w].options[t].id]==null){A+=0*v.questions[w].options[t].weight}else{A+=p[v.questions[w].options[t].id]*v.questions[w].options[t].weight}}}if(v.questions[w].kind=="STARS"){u=Math.round(A/k[w]);for(var y=0;y<v.questions[w].options.length;y++){if(v.questions[w].options[y].weight==u){d+="<input type='radio' disabled='disabled' checked='checked'><i></i>"}else{d+="<input type='radio' disabled='disabled'><i></i>"}}d+="</span> Average rating: "+(A/k[w]).toFixed(2);d+="<br>Total answers: "+k[w]+"<br>"}if(v.questions[w].kind=="RADIO"||v.questions[w].kind=="CHECKBOX"||v.questions[w].kind=="GENDER"||v.questions[w].kind=="THUMBS"||v.questions[w].kind=="SELECT_SINGLE"||v.questions[w].kind=="SELECT_MULTIPLE"){d+="Total answers: "+k[w]+"<br>"}}$("#stats-"+a).html(d)},error:function(i){$("#stats-"+a).html(i.responseJSON.message)}})},error:function(g){$("#stats-"+a).html(g.responseJSON.message)}})}else{if(f.statistics_policy=="PRIVATE"){d+="Segment is private. Only creator can show stats."}else{d+="Segment is secret. Only voters can show stats."}d+="<br><br>Log in to showing stats.<br>";d+="<br><form name='login' id='login' action='' method='post'>";d+="E-mail <input type='text' name='username' data-login='username' size='50'>";d+="Password <input type='password' name='password' data-login='password' size='50'>";d+="<input type='hidden' name='login' data-voter='login' value='login'>";d+="<br><input type='submit' value='Login'><br>";d+="</form>";d+="<br>You can also change the settings of segment in your profile at: <a href='http://www.votehub.net' target='_blank'>www.votehub.net</a>";$("#stats-"+a).html(d)}}else{$("#stats-"+a).empty();d+="Segment is inactive. Only creator can activate segment.";if(votehub_user_id){d+="<br><br>You can activate segment by pressing button.";d+="<br><button onclick='activate_segment("+a+")'>Activate</button>"}else{d+="<br><br>Log in to activating segment.<br>";d+="<br><form name='login' id='login' action='' method='post'>";d+="E-mail <input type='text' name='username' data-login='username' size='50'>";d+="Password <input type='password' name='password' data-login='password' size='50'>";d+="<input type='hidden' name='login' data-voter='login' value='login'>";d+="<br><input type='submit' value='Login'><br>";d+="</form>";d+="<br>You can also activate segment in your profile at: <a href='http://www.votehub.net' target='_blank'>www.votehub.net</a>"}$("#stats-"+a).html(d)}},error:function(d){$("#stats-"+a).html(d.responseJSON.message)}})};